<!DOCTYPE html>
<html>
<head>
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="../dist/one-pixel.umd.js"></script>
  <script src="../dist/editor-umd.js"></script>
</head>
<body>
<style>
  html, body {
    margin: 0;
    padding: 0;
  }

  body {
    height: 100%;
  }

  .container {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
  }

  .controls {
    position: relative;
  }
</style>
<div class="container" id="place"></div>
<div class="controls">
  <button id="reset">reset</button>
  <button id="erase">eraser</button>
  <button id="pen">pen</button>
  <button id="zoomin">+</button>
  <button id="zoomout">-</button>
  <button id="moveright">-></button>
  <button id="moveleft"><-</button>
  <button id="movetop">^</button>
  <button id="movebottom">_</button>
</div>

<script>
  const Pixel = window['one-pixel-2d'].default;
  const EditorPlugin = window['one-pixel-editor'].default;
  const KEY = 'data-demo-one-pixel';

  const storedVal = localStorage.getItem(KEY);
  const basicData = [
    {
      i: '3-ch',
      t: 'i',
      // p: [20, 20, 350, 350],
      s: './googlelogo_color_272x92dp.png'
    },
    {
      i: '1-uk2d', //id
      t: 'l', //  l - line, c - curve, i - image
      p: [1, 1, 200, 200] // points [x, y, x, y]...
    },
    {
      i: '2-uk2d', //id
      t: 'l', //  l - line, c - curve, i - image
      p: [1, 1, 100, 150] // points [x, y, x, y]...
    },
  ];

  let initialData = [...basicData];

  try {
    const parsedJson = JSON.parse(storedVal);
    initialData = parsedJson.val;
  } catch (e) {
  }

  function saveData() {
    const storeData = JSON.stringify({
      val: initialData,
    });
    localStorage.setItem(KEY, storeData);
  }

  const instance = new Pixel('#place', {
    penColor: 'red',
    penWidth: 2,
    eraseWidth: 8,
    lineCap: 'round',
    uuid: 'some-browser-id',
    plugins: [
      EditorPlugin,
    ],
  });

  instance.context.editor.hookAddNode.on(node => {
    console.log(node);
    initialData.push(node);
    saveData();
  });

  instance.setData(initialData);

  instance.redraw();

  document.querySelector('#reset').addEventListener('click', () => {
    initialData = [...basicData];
    instance.setData(initialData);
    instance.redraw();
    saveData();
  });

  document.querySelector('#pen').addEventListener('click', () => {
    instance.setTool('pen');
  });

  document.querySelector('#erase').addEventListener('click', () => {
    instance.setTool('erase');
  });

  let scale = 1;
  document.querySelector('#zoomin').addEventListener('click', () => {
    scale += 0.1;
    instance.context.transformCtrl.scale(scale);
    instance.context.drawCtrl.redraw();
  });

  document.querySelector('#zoomout').addEventListener('click', () => {
    scale -= 0.1;
    instance.context.transformCtrl.scale(scale);
    instance.context.drawCtrl.redraw();
  });

  const offset = {
    x: 0, y: 0,
  }
  document.querySelector('#moveright').addEventListener('click', () => {
    offset.x = offset.x + 10;
    instance.context.transformCtrl.offset(offset.x, offset.y);
    instance.context.drawCtrl.redraw();
  });

  document.querySelector('#moveleft').addEventListener('click', () => {
    offset.x = offset.x - 10;
    instance.context.transformCtrl.offset(offset.x, offset.y);
    instance.context.drawCtrl.redraw();
  });

  document.querySelector('#movetop').addEventListener('click', () => {
    offset.y = offset.y - 10;
    instance.context.transformCtrl.offset(offset.x, offset.y);
    instance.context.drawCtrl.redraw();
  });

  document.querySelector('#movebottom').addEventListener('click', () => {
    offset.y = offset.y + 10;
    instance.context.transformCtrl.offset(offset.x, offset.y);
    instance.context.drawCtrl.redraw();
  });
</script>
</body>
</html>
